version: 2
jobs:
  deploy-prod:
      docker:
        - image: circleci/node:8.14.0
      working_directory: ~/RecipeFormatter/master
      steps:
        - checkout
        - run:
            name: Install dependencies
            command: npm install
        - run:
            name: Build application
            command: npm run build
        - run:
            name: Login Firebase Production Project
            command: ./node_modules/.bin/firebase --token=$FIREBASE_DEPLOY_TOKEN use $FIREBASE_PROJECT_ID_PRODUCTION
        - run:
            name: Deploy master to Firebase
            command: ./node_modules/.bin/firebase deploy --token=$FIREBASE_DEPLOY_TOKEN
workflows:
  version: 2
  build_and_deploy:
    jobs:
      # - build-dev
      # - deploy-dev:
      #     requires:
      #       - build-dev
      #     filters:
      #       branches:
      #         only:
      #           - development
      # - build-staging:
      #     filters:
      #       branches:
      #         only:
      #           - staging
      # - deploy-staging:
      #     requires:
      #       - build-staging
      #     filters:
      #       branches:
      #         only:
      #           - staging
      # - build-production:
      #     filters:
      #       branches:
      #         only:
      #           - master
      - deploy-prod:
          filters:
            branches:
              only:
                - master